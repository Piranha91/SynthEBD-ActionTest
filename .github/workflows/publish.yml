name: Publish

on:
  release:
    types: [published]
      
    env:
      SOLUTION: SynthEBD.sln
    
jobs:
  release:
    runs-on: windows-latest
    steps:
    - name: Clear local NuGet cache (workaround for failed restores on windows-latest)
      run: dotnet clean $env:SOLUTION && dotnet nuget locals all --clear

    - name: Restore dependencies
      run: dotnet restore $env:SOLUTION

    - name: Build
      run: dotnet build $env:SOLUTION --no-restore

    - name: Archive Release
      run: |
        powershell Compress-Archive $env:SOLUTION/bin/Release/net6.0/win-x64/publish/* SynthEBD.zip
    - name: Publish SynthEBD to Github
      uses: svenstaro/upload-release-action@v2
      with:
        file: SynthEBD.zip
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        tag: ${{ github.event.release.tag_name }}
